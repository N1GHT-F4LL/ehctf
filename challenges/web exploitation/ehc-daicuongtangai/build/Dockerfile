FROM ghcr.io/n1ght-f4ll/ehctf/python:alpine

WORKDIR /app
COPY app.py ./
COPY phlag.txt ./
COPY templates templates
COPY poems poems
COPY static static
RUN chmod -R 775 .

RUN mkdir -p /app && \
    pip install --no-cache-dir -i https://pypi.org/simple flask && \
    adduser -D -G www-data -s /bin/ash -h /app www-data

COPY --chmod=500 --chown=www-data:www-data init.sh /etc/init.sh

WORKDIR /app
USER www-data

ENTRYPOINT [ "/bin/sh" , "/etc/init.sh" ]