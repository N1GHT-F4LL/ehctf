import re
from flask import Flask, render_template_string, request

app = Flask(__name__)
regex = "request|config|self|class|flag|0|1|2|3|4|5|6|7|8|9|\"|\'|\\|\~|\%|\#"

error_page = '''
        {% extends "layout.html" %}
        {% block body %}
        <center>
           <section class="section">
              <div class="container">
                 <h1 class="title">Anh b·∫°n √†!</h1>
                 <p>Ch·ªçn waifu th√¥i, hack th√¨ üëá</p>
                 <img src="https://cdn.discordapp.com/attachments/1201422777060700260/1232785716988219462/tetmong.gif?ex=662ab8aa&is=6629672a&hm=0755d3bae1cb2fd073e14f0e72097a223b50dc8874a6dec4c1284dabbcfa40c4&" alt="hack" width="600" height="600" style="display: block; margin: 0 auto;">
              </div>
           </section>
        </center>
        {% endblock %}
        '''


@app.route('/', methods=['GET', 'POST'])
def index():
    if request.method == 'POST':
        if not request.form['waifu']:
            return render_template_string(error_page)

        if len(request.form) > 1:
            return render_template_string(error_page)

        waifu_type = request.form['waifu'].lower()
        if '{' in  waifu_type and re.search(regex, waifu_type):
            return render_template_string(error_page)

        if len(waifu_type) > 256:
            return render_template_string(error_page)

        page = \
            '''
        {{% extends "layout.html" %}}
        {{% block body %}}
        <center>
           <section class="section">
              <div class="container">
                 <h1 class="title">ƒê√¢y l√† waifu c·ªßa t√¥i!</h1>
                 <ul class=flashes>
                    <label>Mu·ªën c√≥ {}, thanh to√°n ti·ªÅn cho shop n√†o üòç</label>
                 </ul>
                 </br>
              </div>
           </section>
           <iframe width="560" height="315" src="https://www.youtube.com/embed/imMD5QRMgsU?si=MQLbNxL5Ur6lYUbw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </center>
        {{% endblock %}}
        '''.format(waifu_type)

    elif request.method == 'GET':
        page = \
            '''
        {% extends "layout.html" %}
        {% block body %}
        <center>
            <section class="section">
              <div class="container">
                 <h1 class="title">Ch√†o m·ª´ng ƒë·∫øn v·ªõi <a href="https://www.facebook.com/ehc.fptu">EHC Waifu</a>, n∆°i b·∫°n l√† ch√≠nh m√¨nh!</h1>
                 <p>Nh·∫≠p t√™n waifu m√† b·∫°n mu·ªën d·∫´n ƒëi ch∆°i nh√©!</p>
                 <form action='/' method='POST' align='center'>
                    <p><input name='waifu' style='text-align: center;' type='text' placeholder='Waifu' /></p>
                    <p><input value='Submit' style='text-align: center;' type='submit' /></p>
                 </form>
              </div>
           </section>
        </center>
        {% endblock %}
        '''
    return render_template_string(page)


app.run('0.0.0.0', 8000)

