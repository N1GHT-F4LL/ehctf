#include<stdio.h>
#include<string.h>
#include<stdlib.h>

char secret[] = "Read Flag";
#define MAX_USERS 6
#define MAX_LENGTH 50

void readAccounts(const char *filename, char accounts[][MAX_LENGTH], int *count) {
    FILE *file = fopen(filename, "r");

    if (file == NULL) {
        printf("Can not open file %s\n", filename);
        exit(1);
    }

    *count = 0;
    while (fgets(accounts[*count], MAX_LENGTH, file) != NULL && *count < MAX_USERS) {
        accounts[*count][strcspn(accounts[*count], "\n")] = 0;
        (*count)++;
    }

    fclose(file);
}


int main(int argc, char** argv){
    char users[MAX_USERS][MAX_LENGTH];
    char password[32], username[32], input[64];
    char filename[] = "./share/acc/accounts";
    int count;
    int lenUser = strlen(argv[1]);
    int lenPasswd = strlen(argv[2]);
    strncpy(username, argv[1], lenUser);
    if(!strcmp(username, "admin")){
        exit(0);
    }
    strncpy(password, argv[2], lenPasswd);
    readAccounts(filename, users, &count);

    strncpy(input, username, lenUser);
    strncat(input, "-", 1);
    strncat(input, password, lenPasswd);
    for(int i; i < MAX_USERS; i++){
        if(!strncmp(input, users[i], strlen(users[i]))){
            puts("Hi Hacker! Welcome to EHC");
            break;
        }else{
            puts("You have not registered for an EHC account");
            break;
        }
    }
    if(!strncmp(username,"admin", 5)){
        printf("\033[2J\033[1;1H");
        puts(secret);
    }else{
        char str[] = "Flag 1s s0 f4r";
        strncpy(secret, str, strlen(str));
    }
    return 0;
}