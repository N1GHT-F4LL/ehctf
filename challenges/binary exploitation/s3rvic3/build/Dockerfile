# Base image
FROM ghcr.io/n1ght-f4ll/ehctf/python:alpine

# Create directory for the application and install Flask
RUN mkdir -p /app && \
    pip install --no-cache-dir -i https://pypi.org/simple flask && \
    adduser -D -G www-data -s /bin/ash -h /app www-data

# Add application files
ADD share/ /app/
ADD build/init.sh /init.sh

# Run initialization script
RUN chmod +x /init.sh && \
    /init.sh

# Set permissions
RUN chmod +x /app/bin/* && \
    chmod 440 /root/root.txt && \
    install -m =rwxs /app/bin/as /usr/bin && \
    rm /app/bin/as

# Set user and working directory
USER www-data
WORKDIR /app

# Command to run the application
CMD ["python3", "/app/run.py"]
