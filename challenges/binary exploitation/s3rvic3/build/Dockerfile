# Base image
FROM ghcr.io/n1ght-f4ll/ehctf/python:alpine

# Create directory for the application and install Flask
RUN mkdir -p /app && \
    pip install --no-cache-dir -i https://pypi.org/simple flask && \
    adduser -D -G root -s /bin/ash -h /app www-data

# Copy application files
COPY --chown=www-data:www-data run.py /app/
COPY --chown=www-data:www-data templates/ /app/templates/
COPY --chown=www-data:www-data acc/ /app/acc/
COPY --chown=www-data:www-data bin/ /app/bin/

# Copy initialization script and set permissions
COPY --chown=www-data:www-data --chmod=500 init.sh /etc/init.sh

# Set user and working directory
USER www-data
WORKDIR /app

# Command to run the application
CMD ["/etc/init.sh"]
