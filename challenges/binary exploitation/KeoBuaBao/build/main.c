#include<time.h>
#include<stdio.h>
#include<unistd.h>
#include<stdlib.h>
#include<string.h>

char* all[] = {"KEO", "BUA", "BAO"};

void init(){
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);
    setvbuf(stderr, NULL, _IONBF, 0);
}

void getOption(char* buf, int size){
    printf("Enter | KEO | BUA | BAO | > ");
    read(0, buf, size-1);
    while(getchar() != '\n');
    buf[sizeof(buf)-1] = '\0';
}

void getOptionM(char* machineChoice, int size, int rand){
    switch(rand + 1){
        case 1:
            strcpy(machineChoice,all[1-1]);
            break;
        case 2:
            strcpy(machineChoice,all[2-1]);
            break;
        case 3:
            strcpy(machineChoice,all[3-1]);
            break;
    }
}

void display(char* buf){
    int len = strlen(buf);
    for(int i = 0; i < len; i++){
        printf("%c", buf[i]);
        fflush(stdout);
        usleep(100000);
    }
    puts("");
}

int main(int argc, char* argv[]){
    init();
    srand((unsigned) time(NULL));
    printf("\033[2J");
    printf("\033[1;1H");
    display("Welcome to KEO-BUA-BAO 🖖✊🖐  game");
    display("Hello hacker, Do you want to win this game?");
    display("Let defeat me in 100 round now");
    sleep(2);
    display("GAME STARTING...");
    int i = 0;
    char yourChoice[4], machineChoice[4];
    while(i<100){
        memset(yourChoice, 0x0, 8);
        memset(machineChoice, 0x0, 8);
        int num = rand() % 13371337;
        getOption(yourChoice, sizeof(yourChoice));
        getOptionM(machineChoice, sizeof(machineChoice), num%3);
        if(strncmp(yourChoice, machineChoice, 3)){
            puts(">>>>> YOU LOSEEEEEE <<<<<\n");
            printf("😥 You: %s - Machine: %s\n", yourChoice, machineChoice);
            exit(0); 
        }else{
            printf(">>>>> ✨ You win in round %d <<<<<\n\n", (i+1));
            i++;
        }    
    }
    system("cat flag.txt");
    puts("");
    return 0;
}